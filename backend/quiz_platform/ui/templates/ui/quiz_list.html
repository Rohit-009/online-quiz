<!DOCTYPE html>
<html>
<head>
    <title>Quiz List</title>
</head>

<body>

<h2>Available Quizzes</h2>

<!-- ðŸ” Block access if not logged in -->
<script>
const token = localStorage.getItem("token");
if(!token){
    window.location.href = "/login/";
}
</script>

<div id="list">Loading...</div>

<button onclick="logout()">Logout</button>

<script>
// ---------- LOAD QUIZZES ----------
fetch("/api/quizzes/")
.then(res => res.json())
.then(data => {

    let html = "";

    data.forEach(q => {

        html += `
            <p>
                <b>${q.title}</b>
                <button onclick="startQuiz(${q.id})">Start</button>
            </p>
        `;
    });

    document.getElementById("list").innerHTML = html;
});


// ---------- PREFETCH QUIZ BEFORE ENTER ----------
function startQuiz(id){

    fetch("/api/quizzes/" + id + "/")
    .then(res => res.json())
    .then(data => {

        // save quiz temporarily
        sessionStorage.setItem("current_quiz", JSON.stringify(data));

        // go to quiz page
        window.location.href = "/quiz/" + id + "/";
    });
}


// ---------- LOGOUT ----------
function logout(){
    localStorage.clear();
    sessionStorage.clear();
    window.location.href = "/login/";
}
</script>

</body>
</html>
